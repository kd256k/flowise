# LSTM 유량 예측 모델 결과 분석 - 131K (03_lstm_flow_131k_hidden32.ipynb)

## 모델 설정

| 항목 | 값 |
|------|-----|
| 데이터 | 129,474개 (2023년 1~3월) |
| input_time | 72분 (1.2시간) |
| output_time | 10분 |
| hidden_size | 32 |
| num_layers | 2 |
| dropout | 0.3 |
| batch_size | 128 |
| weight_decay | 1e-4 |
| 파라미터 수 | 13,258개 |

## 결과

- Train: 90,575개 / Val: 19,409개 / Test: 19,409개
- Early Stopping: Epoch 46 (patience 10)
- Best Val Loss: 0.000366 / Test Loss: 0.000426
- Scaler 범위: [58.72, 316.19]

### 평가 지표

| 지표 | 값 |
|------|-----|
| RMSE | 5.3125 |
| MAE | 4.1666 |
| MAPE | 3.44% |
| R² | 0.9916 |
| Bias | -1.5695 |

### Quartile별 성능

| 구간 | 범위 | 샘플수 | RMSE | MAE | MAPE | R² |
|------|------|--------|------|-----|------|-----|
| Q1 (Low) | [67.5, 88.6] | 48,515 | 3.99 | 3.74 | 4.96% | 0.3102 |
| Q2 | [88.6, 122.6] | 48,525 | 4.73 | 3.81 | 3.55% | 0.7559 |
| Q3 | [122.6, 180.1] | 48,520 | 6.39 | 4.83 | 3.31% | 0.8594 |
| Q4 (High) | [180.1, 315.8] | 48,530 | 5.81 | 4.30 | 1.96% | 0.9684 |

#### Quartile 분석

- **전체 R²=0.9916** vs 구간별 R²: R²는 분산 대비 설명력. 좁은 범위로 제한하면 구간 내 분산이 작아져 R²가 낮아짐. 전체 R²가 모델 품질의 정확한 지표

- **Q1 (Low)**: RMSE 3.99로 가장 낮으나 MAPE 4.96%. 저유량 구간은 절대오차가 작아도 상대오차가 커짐. R²=0.31로 구간 내 설명력 제한적

- **Q2 (Mid-Low)**: R²=0.76으로 양호. MAPE 3.55%

- **Q3 (Mid-High)**: RMSE 6.39로 가장 높으나 R²=0.86으로 구간 내 설명력 확보. MAPE 3.31%

- **Q4 (High)**: R²=0.97로 구간 내에서도 높은 설명력. MAPE 1.96%로 가장 낮음. 고유량 구간은 패턴이 규칙적


Q1 vs Q4 비교:
            Q1 (Low: 67~89)  	     Q4 (High: 180~316)
MAE(절대오차)	  3.74                     (더 작음)4.30
MAPE(상대오차)	 4.96%	                  1.96% (더 작음)

Q1이 절대오차(MAE)는 더 작은데, 상대오차(MAPE)는 더 큼.

같은 오차 5라도:
actual=70 → 5/70 = 7.1%
actual=200 → 5/200 = 2.5%




#### 구간별 핵심 인사이트
1. 모든 구간에서 R²가 양수 (이전: Q1/Q2 음수)
2. MAPE 기준: Q4(1.96%) < Q3(3.31%) < Q2(3.55%) < Q1(4.96%)
3. 고유량일수록 예측 정확도가 높음 (상대오차 기준)
4. Q3 구간의 RMSE가 가장 높지만 R²=0.86으로 설명력 확보

## 600개 모델 대비 개선 비교

| 지표 | 600개 모델 | 131K 모델 | 판단 |
|------|-----------|-----------|------|
| Val/Test Loss 비율 | 24.3배 | 1.16배 | 과적합 해소 |
| Bias (편향) | +8.77 | -1.57 | 편향 대폭 감소 |
| Normalized Test Loss | 0.021247 | 0.000426 | 50배 개선 |
| RMSE/범위 비율 | 6.7% (4.53/68) | 2.1% (5.31/248) | 3배 정밀 |

## 분석

### 과적합 해소
Val Loss(0.000366) ≈ Test Loss(0.000426), 비율 1.16배.
모델이 학습 데이터에 과적합되지 않고 일반화 능력을 확보.

### R² = 0.9916
전체 분산의 99.2%를 설명. 시계열 예측 모델로서 우수한 수준.

### RMSE 분석
RMSE 절대값 5.31, 데이터 범위(248) 대비 2.1%.
3개월 데이터의 넓은 변동(68~316) 대비 높은 정밀도.

## 한계점

- Q1 구간 R²=0.31: 저유량 구간의 설명력 개선 여지
- Bias -1.57: 전반적으로 과대예측 경향. 데이터 범위 대비 0.6% 수준
- Step별 Bias 증가: 예측 거리 증가에 따른 LSTM 고유 한계
- Savgol 필터 후 clip(lower=0) 적용 완료

## 종합 판단

모델 구조와 학습 파이프라인은 정상 작동. 과적합 해소, R²=0.9916.
MAPE 3.44%는 단변량 LSTM의 우수한 성능 수준.
Q1 구간 개선을 위해 입력 변수 추가(날씨, 요일, 시간대 등)로 접근 필요.

## 
Gradient Clipping 추가